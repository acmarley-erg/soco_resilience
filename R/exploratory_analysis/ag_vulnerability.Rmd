---
title: "Agriculture Vulnerability Assesment"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
# load packages
library(tidyverse)
library(sf)
library(here)
library(ggthemes)
library(raster)
```


#### This analysis shows the intersection of agricultural land in Sonoma County and various hazards. Agricultural land includes: Vital Land Priority Croplands and Priority Grazing Lands

```{r, echo = FALSE}
## read in the data ##

# administrative boundaries
soco_bound <- read_sf(here("data/clean/sonoma_county_boundary/sonoma_county_boundary.shp"))

# agriculture
croplands <- read_sf(here("data/raw/Vital_Lands_Data_Package/VLI_Priority_Ag_Croplands.shp"))
grazinglands <- read_sf(here("data/raw/Vital_Lands_Data_Package/VLI_Priority_Ag_Grazing_Land.shp"))
agriculture <- read_sf(here("data/clean/vulnerability_shps/agriculture/agriculture.shp"))

# hazard intersect layers
ag_floodplain <- read_sf(here("data/clean/vulnerability_shps/agriculture/ag_floodplain.shp"))
ag_slr_75 <- read_sf(here("data/clean/vulnerability_shps/agriculture/ag_75_slr.shp"))
ag_slr_75_100 <- read_sf(here("data/clean/vulnerability_shps/agriculture/ag_75_slr_100.shp"))
ag_slr_200 <- read_sf(here("data/clean/vulnerability_shps/agriculture/ag_200_slr.shp"))
ag_fire_risk <- read_sf(here("data/clean/vulnerability_shps/agriculture/ag_fire_risk.shp"))
ag_ls_risk <- raster(here("data/clean/vulnerability_shps/agriculture/ag_landslide_risk.tif"))

```

### **Floodplain**

#### Agricultural lands (brown) and agricultural lands in flood plains (blue)

##### * Note that priority croplands were excluded in floodplains areas, so any blue area is grazing land

```{r, echo = FALSE}
flood_plot <- ggplot() +
  geom_sf(data = soco_bound, fill = "lightgrey") +
  geom_sf(data = croplands, fill = "burlywood4", color = "burlywood4") +
  geom_sf(data = grazinglands, fill = "burlywood4", color = "burlywood4") +
  geom_sf(data = ag_floodplain, fill = "blue", color = "blue") +
  theme_map()
flood_plot

ggsave(filename = "ag_fldplain.png", plot = flood_plot, path = here("output/maps/"), dpi = 350)
```

### **Sea Level Rise**

### Agriculture (brown) and 75 cm slr (dark blue), 75 cm slr + 100 year storm (medium blue), 200 cm slr (light blue)

```{r, echo = FALSE}
slr_plot <- ggplot() +
  geom_sf(data = soco_bound, fill = "lightgrey") +
  geom_sf(data = croplands, fill = "burlywood4", color = "burlywood4") +
  geom_sf(data = grazinglands, fill = "burlywood4", color = "burlywood4") +
  geom_sf(data = ag_slr_200, fill = "#6497b1", color = "#6497b1") +
  geom_sf(data = ag_slr_75_100, fill = "#005b96", color = "#005b96") +
  geom_sf(data = ag_slr_75, fill = "#011f4b", color = "#011f4b") +
  theme_map()

ggsave(filename = "ag_slr.png", plot = slr_plot, path = here("output/maps/"), dpi = 350)
```

### **Wildfire Risk**

#### Agricultural lands colored by their wildfire risk:

```{r, echo = FALSE}
ag_fire_risk <- ag_fire_risk %>% 
  mutate(risk5rank_chr = as.character(risk_5_ran)) %>% 
  mutate(risk5rank_chr = fct_relevel(risk5rank_chr, c("5", "4", "3", "2", "1")))

fire_risk_plot <- ggplot() +
  geom_sf(data = soco_bound, fill = "lightgrey") +
  geom_sf(data = ag_fire_risk, aes(fill = risk5rank_chr), color = NA) +
  scale_fill_brewer(palette = "YlOrRd", direction = -1) +
  labs(fill = "Wildfire Risk") +
  theme_map()

ggsave(filename = "ag_fire_risk.png", plot = fire_risk_plot, path = here("output/maps/"), dpi = 350)
```

### **Landslide Risk**

```{r, echo = FALSE, warning = FALSE}

soco_ls <- st_transform(soco_bound, crs(ag_ls_risk))

colfunc<-colorRampPalette(c("royalblue", "springgreen","yellow","red"))
plot(ag_ls_risk, col=(colfunc(10)))
plot(soco_ls, add = TRUE, col = NA)

```


